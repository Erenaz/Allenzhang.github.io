<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TReE‑FROG — GIF Gallery (Project Page)</title>
  <meta name="description" content="Lightweight GIF gallery for SPAROW results on GitHub Pages. Other sections under construction." />
  <style>
    :root { --bg:#0b0d10; --card:#12151a; --fg:#e8eef6; --muted:#a9b2c3; --accent:#62a8ff; --radius:16px; --bad:#ff6b6b; --ok:#69db7c; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); color:var(--fg)}
    header{position:sticky;top:0;z-index:20;background:rgba(13,17,23,.7);backdrop-filter:blur(6px);border-bottom:1px solid #1e232c}
    .wrap{max-width:1100px;margin:0 auto;padding:14px 16px}
    .brand{display:flex;align-items:center;justify-content:space-between;gap:10px}
    h1{font-size:clamp(20px,3vw,30px);margin:0}
    nav a{color:var(--muted);text-decoration:none;margin-left:12px;font-size:14px}
    nav a.active{color:var(--fg)}

    .notice{background:#0d1421;border:1px solid #23304a;padding:10px 12px;border-radius:12px;margin:12px 16px}

    main{max-width:1100px;margin:0 auto;padding:10px 16px 40px}
    .grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
    .card{background:var(--card);border:1px solid #232936;border-radius:var(--radius);overflow:clip;box-shadow:0 3px 10px rgba(0,0,0,.25);cursor:pointer}
    .card:hover{transform:translateY(-2px);transition:transform .12s ease}
    .thumb{aspect-ratio:16/10;width:100%;display:block;background:#0f1319;position:relative}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .err{position:absolute;inset:0;display:grid;place-items:center;padding:10px;text-align:center;color:#ffbdbd;border:1px dashed #512929;background:#1b0d0d}
    .meta{padding:10px 12px 12px}
    .title{font-weight:600;font-size:14px;margin:0 0 6px}
    .desc{color:var(--muted);font-size:12px;margin:0}

    dialog::backdrop{background:rgba(0,0,0,.6)}
    dialog{border:1px solid #273142;background:#0d1117;color:var(--fg);border-radius:18px;padding:0;max-width:92vw}
    .modal-head{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid #1f2633}
    .close{appearance:none;border:1px solid #2b3342;background:#121720;color:var(--fg);border-radius:10px;padding:6px 10px;cursor:pointer}
    .player{width:min(86vw,1100px);max-height:78vh;margin:0 auto;background:#0f1319;border-radius:14px}
    .player img{width:100%;height:100%;object-fit:contain;display:block}

    .uc{display:grid;place-items:center;height:50vh;color:var(--muted);border:1px dashed #2b3342;border-radius:16px}
    footer{color:var(--muted);font-size:12px;border-top:1px solid #1e232c}
    a{color:var(--accent)}

    /* Diagnostics */
    details.diag{margin:10px 16px;background:#0d1421;border:1px solid #23304a;border-radius:12px}
    details.diag summary{cursor:pointer;padding:10px 12px;color:var(--muted)}
    .diag-body{padding:0 12px 12px}
    .ok{color:var(--ok)} .bad{color:var(--bad)}
    code.small{font-size:11px}
  </style>
</head>
<body>
  <header>
    <div class="wrap brand">
      <h1>TReE‑FROG Project Page</h1>
      <nav>
        <a href="#gallery" id="nav-gallery" class="active">Gallery</a>
        <a href="#docs" id="nav-docs">Docs (Under construction)</a>
      </nav>
    </div>
  </header>

  <div class="notice">
    <strong>Note:</strong> This project page is optimized for <em>GIFs only</em>. For best load times on mobile, target ≤ 960px width, 10–12 fps, and 3–6&nbsp;MB per clip. Place files in <code>assets/gifs/</code>. Avoid leading slashes (use <code>assets/gifs/foo.gif</code>, not <code>/assets/gifs/foo.gif</code>).
  </div>

  <!-- GALLERY -->
  <main id="section-gallery">
    <div id="grid" class="grid"></div>
  </main>

  <!-- UNDER CONSTRUCTION -->
  <main id="section-docs" style="display:none">
    <div class="uc">
      <div>
        <h2 style="margin:0 0 8px">Other Sections — Under Construction</h2>
        <p style="margin:0">Check back soon for methods, calibration notes, and references.</p>
      </div>
    </div>
  </main>

  <dialog id="viewer">
    <div class="modal-head">
      <div id="viewerTitle" style="font-weight:600;font-size:14px">Preview</div>
      <button class="close" id="closeBtn" aria-label="Close">Close</button>
    </div>
    <div class="player" id="player"></div>
    <div style="padding:10px 12px 14px;color:#a9b2c3;font-size:12px" id="viewerDesc"></div>
  </dialog>

  <!-- Diagnostics (shows missing files, wrong paths, LFS pointer hints) -->
  <details class="diag" id="diag">
    <summary>Diagnostics</summary>
    <div class="diag-body" id="diagBody">
      <div>Loading…</div>
    </div>
  </details>

  <footer>
    <div class="wrap" style="display:flex;justify-content:space-between;gap:12px;align-items:center;padding:14px 16px;">
      <div>© <span id="year"></span> TReE‑FROG Team • GitHub Pages</div>
      <div><a id="rawLink" href="#" rel="noopener">Open GIF file</a></div>
    </div>
  </footer>

  <script>
    // ========== 1) LIST YOUR GIFS HERE ==========
    const items = [
      { title: "Shot 001 — Trace", desc: "Gate step 10 fs", gif: "assets/gifs/shot001.gif", restartMs: 3000 },
      { title: "Shot 002 — Retrieval", desc: "Phase sweep", gif: "assets/gifs/shot002.gif", restartMs: 4500 }
      // Add more … (set restartMs ≈ GIF duration in ms to auto-restart if the file itself doesn't loop)
    ];

    // ========== 2) RENDER GRID ==========
    const grid = document.getElementById('grid');
    const makeCard = (it) => {
      const card = document.createElement('article');
      card.className = 'card';
      const safeAlt = (it.title||'SPAROW GIF').replaceAll('"','&quot;');
      card.innerHTML = `
        <div class="thumb">
          <img src="${it.gif}" alt="${safeAlt}" loading="lazy" />
        </div>
        <div class="meta">
          <h3 class="title">${it.title||'Untitled clip'}</h3>
          ${it.desc?`<p class="desc">${it.desc}</p>`:''}
        </div>`;
      // Robust error message if the GIF path is wrong or blocked
      const img = card.querySelector('img');
      img.addEventListener('error', () => {
        const box = document.createElement('div');
        box.className = 'err';
        box.innerHTML = `GIF failed to load:<br><code class="small">${it.gif}</code><br><small>Check path/case, LFS usage, and that the file exists in the repo.</small>`;
        img.replaceWith(box);
      });
      // === Optional auto-restart for non-looping GIFs ===
      if (it.restartMs && Number(it.restartMs) > 0) {
        const base = it.gif;
        const restart = () => {
          // cache-bust to restart animation without re-encoding the GIF
          const url = base + (base.includes('?') ? '&' : '?') + 't=' + Date.now();
          img.src = url;
        };
        const startTimer = () => {
          clearInterval(img._loopTimer);
          img._loopTimer = setInterval(restart, Number(it.restartMs));
        };
        img.addEventListener('load', startTimer);
        // Pause while hovering (optional UX nicety)
        card.addEventListener('mouseenter', () => clearInterval(img._loopTimer));
        card.addEventListener('mouseleave', startTimer);
        // Clean up on page hide
        window.addEventListener('pagehide', () => clearInterval(img._loopTimer));
      }
        box.className = 'err';
        box.innerHTML = `GIF failed to load:<br><code class="small">${it.gif}</code><br><small>Check path/case, LFS usage, and that the file exists in the repo.</small>`;
        img.replaceWith(box);
      });
      card.addEventListener('click', () => openViewer(it));
      return card;
    };
    items.forEach(it => grid.appendChild(makeCard(it)));

    // ========== 3) LIGHTBOX VIEWER (with fallback if <dialog> unsupported) ==========
    const supportsDialog = typeof HTMLDialogElement === 'function';
    const dlg = document.getElementById('viewer');
    const player = document.getElementById('player');
    const viewerTitle = document.getElementById('viewerTitle');
    const viewerDesc = document.getElementById('viewerDesc');
    const rawLink = document.getElementById('rawLink');

    function openViewer(it){
      viewerTitle.textContent = it.title || 'Preview';
      viewerDesc.textContent = it.desc || '';
      rawLink.href = it.gif || '#';
      if (!supportsDialog || !dlg?.showModal) {
        window.open(it.gif, '_blank');
        return;
      }
      player.innerHTML = `<img id="viewerImg" src="${it.gif}" alt="${(it.title||'SPAROW GIF').replaceAll('"','&quot;')}" style="width:100%;height:100%;object-fit:contain;border-radius:14px"/>`;
      // Auto-restart in modal if restartMs provided
      const vimg = document.getElementById('viewerImg');
      if (it.restartMs && Number(it.restartMs) > 0) {
        const base = it.gif;
        const restart = () => {
          const url = base + (base.includes('?') ? '&' : '?') + 't=' + Date.now();
          vimg.src = url;
        };
        const startTimer = () => {
          clearInterval(vimg._loopTimer);
          vimg._loopTimer = setInterval(restart, Number(it.restartMs));
        };
        vimg.addEventListener('load', startTimer);
        dlg.addEventListener('close', () => clearInterval(vimg._loopTimer), { once: true });
      }
      dlg.showModal();
    }
      player.innerHTML = `<img src="${it.gif}" alt="${(it.title||'SPAROW GIF').replaceAll('"','&quot;')}" style="width:100%;height:100%;object-fit:contain;border-radius:14px"/>`;
      dlg.showModal();
    }
    document.getElementById('closeBtn').addEventListener('click', ()=> dlg.close());
    dlg.addEventListener('click', (e)=>{ if(e.target===dlg) dlg.close(); });

    // ========== 4) SIMPLE NAV ==========
    const secG = document.getElementById('section-gallery');
    const secD = document.getElementById('section-docs');
    const nG = document.getElementById('nav-gallery');
    const nD = document.getElementById('nav-docs');
    function route(){
      const h = location.hash || '#gallery';
      const showGallery = h.includes('gallery');
      secG.style.display = showGallery ? '' : 'none';
      secD.style.display = showGallery ? 'none' : '';
      nG.classList.toggle('active', showGallery);
      nD.classList.toggle('active', !showGallery);
    }
    addEventListener('hashchange', route);
    route();

    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    // ========== 5) DIAGNOSTICS ==========
    (function diag(){
      const body = document.getElementById('diagBody');
      const rows = [];
      items.forEach((it, i) => {
        const url = new URL(it.gif, location.href).href;
        rows.push(`<div style="padding:6px 0;border-bottom:1px solid #1c2433">
          <div><strong>#${i+1}</strong> ${(it.title||'Untitled')} — <code class="small">${it.gif}</code></div>
          <div id="st${i}">Checking…</div>
          <div><a href="${url}" target="_blank" rel="noopener">Open raw</a></div>
        </div>`);
      });
      body.innerHTML = rows.join('');

      // try a lightweight fetch to see if the file exists
      items.forEach((it, i)=>{
        const st = document.getElementById('st'+i);
        fetch(it.gif, { method: 'GET', cache: 'no-store' })
          .then(async r => {
            if (!r.ok) throw new Error(r.status+" "+r.statusText);
            const ct = r.headers.get('content-type')||'';
            const len = r.headers.get('content-length');
            // If it's an LFS pointer, content-type may be text/plain and size tiny
            const hint = (!ct.includes('image') ? ' (non-image content-type; LFS pointer?)' : '') + (len && +len < 1024 ? ' (very small file; LFS pointer?)' : '');
            st.innerHTML = `<span class="ok">OK</span> ${ct}${len?` • ${len}B`:''}${hint}`;
          })
          .catch(err => {
            st.innerHTML = `<span class="bad">FAIL</span> ${err?.message||'Network error'} — likely wrong path/case or missing file.`;
          });
      });
    })();
  </script>

  <noscript>
    <div class="notice" style="margin:16px">This page needs JavaScript to render the gallery. If images still fail to appear with JS enabled, verify that your GIF paths (e.g., <code>assets/gifs/foo.gif</code>) match filenames exactly (case‑sensitive) and that the files are committed (not Git LFS pointers).</div>
  </noscript>
</body>
</html>